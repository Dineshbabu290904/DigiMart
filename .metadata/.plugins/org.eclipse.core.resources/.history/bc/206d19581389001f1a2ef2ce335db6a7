<%@ page import="java.sql.*, java.io.*, javax.servlet.http.*, javax.servlet.ServletException" %>
<%@ page import="com.shopping.project.ConnectionProvider" %>
<%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%>

<%
    String name = request.getParameter("name");
    String category = request.getParameter("category");
    String price = request.getParameter("price");
    String available_qty = request.getParameter("available_qty");
    String description = request.getParameter("description");
    String unit = request.getParameter("unit");

    Part imagePart = request.getPart("image");
    InputStream imageStream = null;

    if (imagePart != null) {
        imageStream = imagePart.getInputStream();
    }

    try {
        // Establish connection to the database
        Connection con = ConnectionProvider.getCon();
        String query = "INSERT INTO Products (name, category, price_per_unit, available_qty, description, unit, image) VALUES (?, ?, ?, ?, ?, ?, ?)";
        PreparedStatement pstmt = con.prepareStatement(query);

        pstmt.setString(1, name);
        pstmt.setString(2, category);
        pstmt.setString(3, price);
        pstmt.setString(4, available_qty);
        pstmt.setString(5, description);
        pstmt.setString(6, unit);
        if (imageStream != null) {
            pstmt.setBinaryStream(7, imageStream, (int) imagePart.getSize());
        } else {
            pstmt.setNull(7, java.sql.Types.BLOB);
        }

        int result = pstmt.executeUpdate();

        if (result > 0) {
            out.println("<h3 class='alert'>Product Added Successfully!</h3>");
        } else {
            out.println("<h3 class='alert'>Something went wrong! Try Again!</h3>");
        }

    } catch (Exception e) {
        e.printStackTrace();
        out.println("<h3 class='alert'>Error: " + e.getMessage() + "</h3>");
    }
%>
